<!DOCTYPE html>
<html lang="tr">
<head>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <meta charset="UTF-8" />
  <title>Matematik Oyunu â€“ Oda GiriÅŸi</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Ä°steÄŸe baÄŸlÄ± font (Ã§alÄ±ÅŸmazsa serif'e dÃ¼ÅŸer) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* ========= Tema / Palet ========= */
    :root{
      --parchment:#f6efe1;       /* sayfa zemini (kÄ±rÄ±k beyaz) */
      --paper:#fffdf6;           /* iÃ§ kart zemini */
      --ink:#2b1d0e;             /* yazÄ± (mÃ¼rekkep) */
      --muted:#6b5641;           /* ikincil metin */
      --gold:#b38a3e;            /* pirinÃ§ kenarlÄ±klar */
      --border:#d8c7a3;          /* aÃ§Ä±k kenarlÄ±k */
      --shadow:0 14px 40px rgba(0,0,0,.18);
      --radius:12px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink);
      font-family: "Libre Baskerville", Georgia, serif;
      background:
        radial-gradient(1200px 700px at 50% 0%, #f8f1e6 0%, #efe3cd 60%, #e6d5b5 100%),
        repeating-linear-gradient(10deg, #0000 0 24px, #00000006 24px 25px);
    }

    /* Ana Ã§erÃ§eve (Victorian Ã§izgiler) */
    .frame{
      max-width: 980px; margin: 32px auto; padding: 28px;
      background: var(--parchment);
      border: 1px solid var(--gold);
      border-radius: 10px;
      box-shadow: var(--shadow);
      position: relative;
    }
    .frame::before, .frame::after{
      content:""; position:absolute; inset:10px;
      border: 3px double var(--gold);
      border-radius: 8px;
      pointer-events:none;
    }
    .title{
      text-align:center; margin: 0 0 18px; font-size: 28px; letter-spacing:.02em;
      font-variant: small-caps;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr; /* sol form, saÄŸ oda listesi */
      gap: 18px;
    }

    /* Kartlar */
    .card{
      background: var(--paper);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: inset 0 0 0 1px #ffffff80;
      padding: 18px;
    }
    .card h3{
      margin: 0 0 12px; font-size: 18px;
      border-bottom: 1px solid var(--border); padding-bottom: 8px;
    }

    /* Form */
    label{display:block; font-size:14px; color:var(--muted); margin-bottom:6px}
    .input{
      width:100%; padding:12px 14px; border-radius:10px;
      border:1px solid var(--border); background:#fffdf9; color:var(--ink);
      font-size:16px; outline:none;
    }
    .input:focus{border-color:var(--gold); box-shadow:0 0 0 3px #b38a3e21}
    .btn{
      width:100%; padding:12px 14px; margin-top:10px;
      border-radius:10px; border:1px solid #8a6a2a;
      background: linear-gradient(#e9d6a6, #d6b86a);
      font-weight:700; cursor:pointer;
    }
    .btn:hover{filter:brightness(1.04)}

    /* Oda listesi */
    #roomList{display:flex; flex-direction:column; gap:10px}
    .room{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 14px; border:1px solid var(--border); border-radius:10px;
      background:#fffdf9; cursor:pointer; transition:transform .06s ease, background .2s;
    }
    .room:hover{transform:translateY(-1px); background:#fff7e9}
    .room .name{font-weight:700}
    .status{font-size:13px; color:var(--muted)}
    .dot{font-size:14px; margin-left:6px}

    /* Alt bilgi */
    .foot{margin-top:14px; text-align:center; font-size:13px; color:var(--muted)}
    @media (max-width: 960px){
      .grid{grid-template-columns:1fr}
    }
  </style>

  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <main class="frame">
    <h1 class="title">Matematik Oyunu</h1>

    <section class="grid">
      <!-- Sol: GiriÅŸ formu -->
      <div class="card">
        <h3>Odaya KatÄ±l</h3>
        <div>
          <label for="name">KullanÄ±cÄ± adÄ±nÄ±z</label>
          <input id="name" class="input" placeholder="Ã¶r. user1" />
        </div>
        <div style="margin-top:10px">
          <label for="room">Oda adÄ± (yeni veya var olan)</label>
          <input id="room" class="input" placeholder="Ã¶r. TestRoom" />
        </div>
        <button id="joinBtn" class="btn" type="button">Odaya KatÄ±l</button>
      </div>

      <!-- SaÄŸ: Oda listesi -->
      <div class="card">
        <h3>Mevcut Odalar</h3>
        <div id="roomList"></div>
        <div class="foot">Bir odaya tÄ±klayarak katÄ±labilirsiniz.</div>
      </div>
    </section>
  </main>

  <script>
    /* ========== Socket baÄŸlan ========== */
    const socket = io();

    /* ========== YardÄ±mcÄ±lar ========== */
    function statusText(r){
      if (r.inGame) return 'OynanÄ±yor';
      if (r.isWaiting) return 'Bekliyor';
      if (r.isFull) return 'Dolu';
      return 'HazÄ±r';
    }
    function statusDot(r){
      if (r.inGame) return 'ðŸŸ¢';
      if (r.isWaiting) return 'ðŸŸ¡';
      if (r.isFull) return 'ðŸ”´';
      return 'ðŸ”µ';
    }

    /* ========== Odaya katÄ±l butonu ========== */
    const joinBtn = document.getElementById('joinBtn');
    const nameInput = document.getElementById('name');
    const roomInput = document.getElementById('room');

    function goToGame(room, name){
      window.location.href =
        `/game.html?room=${encodeURIComponent(room)}&name=${encodeURIComponent(name)}`;
    }

    joinBtn.addEventListener('click', () => {
      const name = (nameInput.value || '').trim();
      const room = (roomInput.value || '').trim();
      if (!name || !room) { alert('LÃ¼tfen kullanÄ±cÄ± adÄ± ve oda adÄ± girin.'); return; }
      goToGame(room, name);
    });

    // Enter ile hÄ±zlÄ± giriÅŸ
    [nameInput, roomInput].forEach(inp => inp.addEventListener('keydown', e => {
      if (e.key === 'Enter') joinBtn.click();
    }));

    /* ========== Oda listesi ========== */
    const listEl = document.getElementById('roomList');

    function renderRooms(rooms){
      listEl.innerHTML = '';
      rooms.forEach(r => {
        const div = document.createElement('div');
        div.className = 'room';

        const left = document.createElement('div');
        left.innerHTML = `<span class="name">${r.name}</span>
                          <span class="status">(${r.userCount} oyuncu)</span>`;

        const right = document.createElement('div');
        right.className = 'status';
        right.innerHTML = `${statusText(r)} <span class="dot">${statusDot(r)}</span>`;

        div.appendChild(left);
        div.appendChild(right);

        div.onclick = () => {
          const name = (nameInput.value || '').trim() || prompt('KullanÄ±cÄ± adÄ±nÄ±z');
          if (!name) return;
          nameInput.value = name;
          roomInput.value = r.name;
          goToGame(r.name, name);
        };

        listEl.appendChild(div);
      });
    }

    // Ä°lk liste isteÄŸi
    socket.emit('getRooms');
    socket.on('roomList', renderRooms);
  </script>
</body>
</html>
